---
import Layout from '~/layouts/BlogLayout.astro';
import SinglePost from '~/components/blog/SinglePost.astro';
import RelatedPosts from '~/components/blog/RelatedPosts.astro';
import {getPostBySlug, getSortedPosts} from '../../utils/blog';
import {Post} from '../../types';

export async function getStaticPaths() {
  let posts = await getSortedPosts();

  return posts.map(post => {
    return {
      params: {
        slug: post.data.slug,
      },
      props: {
        allPosts: posts,
        post: post,
      },
    };
  });
}

export interface Props {
  allPosts: Post[];
  post: Post;
}

const {slug} = Astro.params;
const {allPosts, post} = Astro.props;
---

<Layout title={post.data.title} description={post.data.description}>
  <div class="mx-auto max-w-7xl px-6 sm:px-8 lg:px-10">
    <SinglePost post={post} url={slug} />

    <div class="mt-8">
      <a href="./../">Back to blog</a>
    </div>

    {allPosts.length > 0 && <RelatedPosts posts={allPosts} />}
  </div>
</Layout>
